(()=>{"use strict";let e,n="";function t(e){if(0!=e.indexOf("chrome://")&&0!=e.length)return new URL(e).origin}function o(e){if(e!=n&&null!=e)return n=e,console.log("call api with :"+e),{}}function r(e){const n=e.target.result.createObjectStore("records",{keyPath:"id",autoIncrement:!0});n.createIndex("key",["domain","interval"],{unique:!0}),n.createIndex("domain","domain",{unique:!1}),n.createIndex("interval","interval",{unique:!1}),n.createIndex("bytes","bytes",{unique:!1})}chrome.runtime.onInstalled.addListener((function(){console.log("Extension has been installed")})),chrome.tabs.onActivated.addListener((function(e){chrome.tabs.get(e.tabId,(function(e){o(t(e.url))}))})),chrome.tabs.onUpdated.addListener((function(e,n,r){o(t(r.url))})),function(){const n=indexedDB.open("records",9);n.onerror=function(e){console.error("error opening db")},n.onupgradeneeded=r,n.onsuccess=function(n){e=n.target.result,chrome.webRequest.onCompleted.addListener((function(n){if(!n.responseHeaders)return;const t=n.responseHeaders.find((e=>"content-length"==e.name.toLowerCase()));t&&async function(n,t,o){const r=e.transaction(["records"],"readwrite").objectStore("records");r.index("key").get([o,t]).onsuccess=function(e){const c=e.target.result;c?function(e,n,t){n.bytes+=t;const o=e.put(n);o.onsuccess=function(e){console.log("record updated")},o.onerror=function(e){console.error("error updating record")}}(r,c,n):function(e,n,t,o){const r={domain:n,interval:t,bytes:o};e.add(r).onsuccess=function(e){console.log("record added")}}(r,o,t,n)}}(parseInt(t.value),function(){const e=new Date;return e.setMinutes(0,0,0),e.getTime()/1e3}(),n.initiator)}),{urls:["<all_urls>"]},["responseHeaders"])}}()})();